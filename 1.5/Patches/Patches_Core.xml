<?xml version="1.0" encoding="utf-8"?>
<Patch>

    <!--__________ Animal __________-->

    <!--_____ Brahmin _____-->

    <!-- Add To Biome -->

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/BiomeDef/allowedPackAnimals</xpath>
        <value>
            <li>FCP_Animal_Brahmin</li>
        </value>
    </Operation>

    <!--__________ Currency __________-->

    <!--  HOW TO USE THE MODEXTENSION
		- Automatically adds the mod extension to every faction that DOESN'T already have the mod extensions
		- If a faction already has the mod extension, they'll keep using whatever currency is already defined
		- HOWEVER make sure you use <modExtensions Inherit="False"> if inheriting from a non-abstract faction def, otherwise they will use the currency from that def instead
	-->

    <!--_____ Bottle Caps _____-->

    <!-- Bottle Caps currency replacement for FactionDefs -->

    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/FactionDef[not(modExtensions/li[@Class="FCP.Currencies.CurrencyReplacement"])]</xpath>
        <value>
            <li Class="FCP.Currencies.CurrencyReplacement">
                <currency>FCP_Currency_Caps</currency>
            </li>
        </value>
    </Operation>

    <!-- Bottle Caps currency replacement for TraderKinds -->

    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/TraderKindDef[orbital="true" and not(modExtensions/li[@Class="FCP.Currencies.CurrencyReplacement"])]</xpath>
        <value>
            <li Class="FCP.Currencies.CurrencyReplacement">
                <currency>FCP_Currency_Caps</currency>
            </li>
        </value>
    </Operation>

    <!-- Patch to replace scenarios that start with silver, to instead start with caps -->

    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ScenarioDef/scenario/parts/li[thingDef="Silver"]/thingDef</xpath>
        <value>
            <thingDef>FCP_Currency_Caps</thingDef>
        </value>
    </Operation>

    <!-- Add a honor value to silver -->

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName="Silver"]/statBases</xpath>
        <value>
            <RoyalFavorValue>0.0015</RoyalFavorValue>
        </value>
    </Operation>

    <!--__________ Enlistment Patches __________-->

    <!-- Enlistment comp patch -->

    <Operation Class="PatchOperationSequence">
        <operations>
            <li Class="PatchOperationConditional">
                <xpath>Defs/WorldObjectDef[defName="Settlement"]/comps/li[@Class="FCP.Enlist.WorldObjectCompProperties_Enlist"]</xpath>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/WorldObjectDef[defName="Settlement"]/comps</xpath>
                    <value>
                        <li Class="FCP.Enlist.WorldObjectCompProperties_Enlist" />
                    </value>
                </nomatch>
            </li>
        </operations>
    </Operation>

    <!--__________ Legendary Effects __________-->

    <!--_____ StatDefs _____-->

    <!-- StatDef value -->

    <Operation Class="PatchOperationConditional">
        <xpath>Defs/StatDef[not(@abstract) and not(@ParentName)]/parts</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/StatDef</xpath>
            <value>
                <parts />
            </value>
        </nomatch>
    </Operation>

    <!-- StatDef "FCP.Core.Stats.StatPart_LegendaryEffects" added -->

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/StatDef[not(@abstract) and not(@ParentName)]/parts</xpath>
        <value>
            <li Class="FCP.Core.Stats.StatPart_LegendaryEffects"/>
        </value>
    </Operation>

    <!-- StatDef RangedCooldownFactor added -->

    <Operation Class="PatchOperationConditional">
        <xpath>Defs/StatDef[defName="RangedCooldownFactor"]/parts</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/StatDef[defName="RangedCooldownFactor"]</xpath>
            <value>
                <parts />
            </value>
        </nomatch>
    </Operation>

    <!-- StatDef Class "FCP.Core.Stats.StatPart_Rapid" added for RangedCooldownFactor -->

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/StatDef[defName="RangedCooldownFactor"]/parts</xpath>
        <value>
            <li Class="FCP.Core.Stats.StatPart_Rapid">
                <multiplier>0.60</multiplier>
            </li>
        </value>
    </Operation>

    <!-- StatDef AimingDelayFactor added -->

    <Operation Class="PatchOperationConditional">
        <xpath>Defs/StatDef[defName="AimingDelayFactor"]/parts</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/StatDef[defName="AimingDelayFactor"]</xpath>
            <value>
                <parts />
            </value>
        </nomatch>
    </Operation>

    <!-- StatDef Class "FCP.Core.Stats.StatPart_Rapid" added for AimingDelayFactor -->

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/StatDef[defName="AimingDelayFactor"]/parts</xpath>
        <value>
            <li Class="FCP.Core.Stats.StatPart_Rapid">
                <multiplier>0.60</multiplier>
            </li>
        </value>
    </Operation>

    <!-- StatDef Class MeleeCooldownFactor added -->

    <Operation Class="PatchOperationConditional">
        <xpath>Defs/StatDef[defName="MeleeCooldownFactor"]/parts</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/StatDef[defName="MeleeCooldownFactor"]</xpath>
            <value>
                <parts />
            </value>
        </nomatch>
    </Operation>

    <!-- StatDef Class "FCP.Core.Stats.StatPart_Rapid" added for MeleeCooldownFactor -->

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/StatDef[defName="MeleeCooldownFactor"]/parts</xpath>
        <value>
            <li Class="FCP.Core.Stats.StatPart_Rapid">
                <multiplier>0.60</multiplier>
            </li>
        </value>
    </Operation>

    <!--__________ Think Tree patches __________-->

    <!--_____ Hostile Animal Think Tree _____-->

    <!-- Added Think Tree "FCP.Core.JobGiver_ReactToDistantThreat" -->

    <Operation Class="PatchOperationInsert">
        <xpath>Defs/ThinkTreeDef[defName="Animal"]/thinkRoot/subNodes/li[@Class="JobGiver_ReactToCloseMeleeThreat"]</xpath>
        <value>
            <li Class="FCP.Core.JobGiver_ReactToDistantThreat"/>
        </value>
    </Operation>

    <!-- Added Think Tree for FCP_Mental_State_Hostile_Animal_Think_Tree -->

    <Operation Class="PatchOperationInsert">
        <xpath>Defs/ThinkTreeDef[defName="Animal"]/thinkRoot/subNodes/li[treeDef="MentalStateCritical"]</xpath>
        <value>
            <li Class="ThinkNode_Subtree">
                <treeDef>FCP_Mental_State_Hostile_Animal_Think_Tree</treeDef>
            </li>
        </value>
    </Operation>

    <!--__________ Music Expanded __________-->

    <!--_____ Cues _____-->

    <!-- Battle Cues -->

    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/IncidentDef[ defName="RaidEnemy" 
            or defName="Infestation"
            or defName="Ambush"
            or defName="ManhunterAmbush"
            or defName="DeepDrillInfestation"
            or defName="ManhunterPack"
            or defName="AnimalInsanityMass"
            or defName="MechCluster"
            or defName="AnimalInsanitySingle"]
        </xpath>
        <value>
            <li Class="MusicExpanded.ModExtension.PlayCue">
                <playBattleTrack>true</playBattleTrack>
            </li>
        </value>
    </Operation>

    <!--__________ Work Givers __________-->

    <!--_____ FCP production stations _____-->

    <!-- Cooking stations -->

    <Operation Class="PatchOperationAdd">
        <xpath>/Defs/WorkGiverDef[defName="DoBillsCook"]/fixedBillGiverDefs</xpath>
        <value>
            <li>FCP_Production_Cooking_Station_Fueled_Simple</li>
            <li>FCP_Production_Cooking_Station_Fueled_Complex</li>
            <li>FCP_Production_Cooking_Station_Electric</li>
        </value>
    </Operation>

    <!-- Fabrication stations -->

    <Operation Class="PatchOperationAdd">
        <xpath>/Defs/WorkGiverDef[defName="DoBillsFabricationBench"]/fixedBillGiverDefs</xpath>
        <value>
            <li>FCP_Production_Tool_Bench</li>
            <li>FCP_Production_Fabrication_Workbench</li>
        </value>
    </Operation>

    <!-- Nachining station -->

    <Operation Class="PatchOperationAdd">
        <xpath>/Defs/WorkGiverDef[defName="DoBillsMachiningTable"]/fixedBillGiverDefs</xpath>
        <value>
            <li>FCP_Production_Armor_Workbench</li>
            <li>FCP_Production_Ammo_Press</li>
        </value>
    </Operation>

    <!-- Weapon Station -->

    <Operation Class="PatchOperationAdd">
        <xpath>/Defs/WorkGiverDef[defName="DoBillsMakeWeapons"]/fixedBillGiverDefs</xpath>
        <value>
            <li>FCP_Production_Complex_Weapons_Workbench</li>
            <li>FCP_Production_Simple_Weapons_Workbench</li>
        </value>
    </Operation>

    <!-- Apparel Station -->

    <Operation Class="PatchOperationAdd">
        <xpath>/Defs/WorkGiverDef[defName="DoBillsMakeApparel"]/fixedBillGiverDefs</xpath>
        <value>
            <li>FCP_Production_Tailoring_Workbench</li>
        </value>
    </Operation>

    <!-- Chem Station -->

    <Operation Class="PatchOperationAdd">
        <xpath>/Defs/WorkGiverDef[defName="DoBillsProduceDrugs"]/fixedBillGiverDefs</xpath>
        <value>
            <li>FCP_Production_Chemistry_Workbench</li>
        </value>
    </Operation>

</Patch>